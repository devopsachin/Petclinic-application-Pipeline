@Library('pet-clinic') _
import org.foo.*;

pipeline{
    agent any
    environment{
        def props = readJSON file: 'resources/pet-clinic.json'
        branch = "${props.gitBranch}"
        gitRepoUrl = "${props.repoUrl}"
        applicationPath = "${props.commonUrl}"
        dockerPath = "${props.dockerFilePath}"
        dockerRepo = "${props.dockerRepoName}"
        applicationName = "${props.applicationName}"
        username = "${props.serveruserName}"
        ipAdr = "${props.serveripAddress}"
        applicationPort = "${props.port}"

    }
    stages{
        stage('Chekout SCM'){
            steps{
                script{
                    pullGit(
                        branch: "$branch",
                        url: "$gitRepoUrl"
                    )
                }
            }
        }
        stage('Build'){
            steps{
                script{
                    mvnBuild 'validate'
                    //mvnBuild 'package'
                }
            }
        }
        stage('Test'){
            steps{
                script{
                    //mvnBuild 'test'
                    echo "Hi"
                }
            }
            post{
                always{
                    //junit "$applicationPath/TEST-*.xml"
                    echo "Hi"
                }
            }
        }
        stage('Push to docker'){
            steps{
                script{
                    def x = new B(this)
                    x.dockerLogin 'docker-hub'
                    x.dockerBuild '${WORKSPACE}@script/$dockerPath', '$dockerRepo' , '$applicationName:$BUILD_NUMBER'
                    x.dockerPush '$dockerRepo' , '$applicationName:$BUILD_NUMBER'
                }
            }
        }
        stage('echo'){
            steps{
                script{
                    echo "Hello world"
                }
            }
                
            }
        }
        
    }
